# Trajectory Planning Analysis and Visualization Tools

This directory contains comprehensive analysis and visualization tools for trajectory planning evaluation data generated by the enhanced SinglePoseEvaluator system.

## Overview

The enhanced trajectory planning evaluation system now provides comprehensive metrics including:
- **Performance Metrics**: Planning time, trajectory quality, smoothness, execution time
- **Safety Metrics**: Clearance analysis, time-to-collision, self-clearance, safety violations
- **Quality Metrics**: Manipulability analysis, singularity detection, redundancy utilization, dynamic feasibility

## Visualization Tools

### 1. Comprehensive Analysis Script (`visualize_trajectory_analysis.py`)

The main analysis script providing complete trajectory planning evaluation visualization and reporting.

#### Features:
- **Performance Analysis**: Planning time distribution, trajectory quality metrics, algorithm comparison
- **Safety Analysis**: Clearance distribution, time-to-collision assessment, safety violation tracking
- **Quality Analysis**: Manipulability distribution, dynamic feasibility assessment, motion smoothness
- **Comprehensive Dashboard**: Multi-metric overview with safety assessment maps
- **Export Capabilities**: PNG visualizations, JSON statistics, text reports, processed CSV data

#### Usage:
```bash
# Activate the virtual environment
source venv_analysis/bin/activate

# Generate comprehensive analysis report
python visualize_trajectory_analysis.py /path/to/results.csv --export --output analysis_output

# View interactive plots
python visualize_trajectory_analysis.py /path/to/results.csv --show

# Both export and show
python visualize_trajectory_analysis.py /path/to/results.csv --export --show --output my_analysis
```

#### Command Line Options:
- `--export, -e`: Export complete analysis report with all visualizations
- `--show, -s`: Display interactive plots
- `--output, -o`: Specify output directory for exported files

### 2. Quick Dashboard Script (`quick_dashboard.py`)

A simplified script for rapid interactive visualization of key metrics.

#### Features:
- Success rate overview
- Planning time distribution
- Safety assessment (clearance and time-to-collision)
- Manipulability analysis
- Performance summary table

#### Usage:
```bash
source venv_analysis/bin/activate
python quick_dashboard.py /path/to/results.csv
```

## Generated Data Format

The enhanced evaluator generates CSV files with the following key columns:

### Basic Metrics:
- `trial`: Trial number
- `success`: Success flag (1/0)
- `planning_time_ms`: Planning time in milliseconds
- `algorithm`: Planning algorithm used

### Performance Metrics:
- `trajectory_length`: Total trajectory length
- `smoothness`: Trajectory smoothness measure
- `num_waypoints`: Number of waypoints
- `joint_distance`: Joint space distance
- `max_velocity`: Maximum velocity
- `max_acceleration`: Maximum acceleration
- `energy_consumption`: Energy consumption estimate
- `execution_time`: Estimated execution time

### Safety Metrics:
- `min_clearance`: Minimum clearance to obstacles
- `avg_clearance`: Average clearance along path
- `clearance_variance`: Clearance variance
- `critical_violations`: Number of critical clearance violations
- `min_self_clearance`: Minimum self-collision clearance
- `clearance_path_ratio`: Ratio of safe path length
- `min_ttc`: Minimum time-to-collision
- `avg_ttc`: Average time-to-collision
- `critical_ttc_violations`: Number of critical TTC violations

### Quality Metrics:
- `min_manipulability`: Minimum manipulability index
- `avg_manipulability`: Average manipulability index
- `singularity_violations`: Number of singularity violations
- `redundancy_utilization`: Redundancy utilization ratio
- `max_joint_torque`: Maximum joint torque
- `avg_joint_torque`: Average joint torque
- `dynamic_feasibility`: Dynamic feasibility flag
- `velocity_variance`: Velocity variance
- `acceleration_variance`: Acceleration variance

## Setup Instructions

### 1. Install Dependencies

Create a virtual environment and install required packages:

```bash
# Create virtual environment
python3 -m venv venv_analysis

# Activate virtual environment
source venv_analysis/bin/activate

# Install required packages
pip install pandas matplotlib seaborn numpy scipy
```

### 2. Generate Test Data

Run the enhanced evaluator to generate data with comprehensive metrics:

```bash
# Build the enhanced evaluator
mkdir -p build && cd build
cmake .. && make

# Run evaluation with comprehensive analysis
./build/apps/UltrasoundRepositioningEvaluator/TestClearanceFunctionality
```

### 3. Run Analysis

Use the visualization tools to analyze the generated data:

```bash
# Activate environment
source venv_analysis/bin/activate

# Run comprehensive analysis
python visualize_trajectory_analysis.py /tmp/clearance_test/single_pose_results_*.csv --export --output my_analysis

# Or use quick dashboard
python quick_dashboard.py /tmp/clearance_test/single_pose_results_*.csv
```

## Output Files

The comprehensive analysis generates:

### Visualizations:
- `performance_analysis.png`: Performance metrics analysis
- `safety_analysis.png`: Safety assessment visualizations
- `quality_analysis.png`: Quality metrics analysis
- `comprehensive_dashboard.png`: Multi-metric dashboard

### Data Files:
- `analysis_report.txt`: Human-readable analysis report
- `statistics_summary.json`: Machine-readable statistics
- `successful_trials_data.csv`: Filtered successful trials data
- `complete_data.csv`: Complete dataset

## Safety Assessment Thresholds

The analysis uses the following safety thresholds:

### Clearance Safety:
- **Critical**: < 5cm clearance
- **Safe**: > 15cm clearance

### Time-to-Collision:
- **Critical**: < 1.0s TTC
- **Safe**: > 3.0s TTC

### Manipulability:
- **Critical**: < 0.01 (near singularity)
- **Safe**: > 0.1 (good manipulability)

### Joint Torque:
- **Safe**: < 30.0 Nm
- **Critical**: > 50.0 Nm

## Research Applications

This analysis framework is designed for:
- **Algorithm Comparison**: Compare different trajectory planning algorithms
- **Safety Assessment**: Evaluate trajectory safety in complex environments
- **Performance Optimization**: Identify bottlenecks and optimization opportunities
- **Research Publication**: Generate publication-ready visualizations and statistics

## Example Analysis Workflow

1. **Data Generation**: Run enhanced evaluator with comprehensive analysis enabled
2. **Quick Review**: Use `quick_dashboard.py` for rapid assessment
3. **Detailed Analysis**: Run `visualize_trajectory_analysis.py` for complete report
4. **Results Interpretation**: Review generated reports and visualizations
5. **Publication**: Use exported PNG files and statistics for research papers

## Troubleshooting

### Common Issues:

1. **Missing Dependencies**: Ensure all Python packages are installed in the virtual environment
2. **Data Format Issues**: Verify that CSV files contain all expected columns
3. **Memory Issues**: For large datasets, consider processing in smaller batches
4. **Display Issues**: For headless systems, use `--export` without `--show`

### Performance Notes:

- Analysis of 100+ trials may take several minutes
- Large datasets benefit from the comprehensive analysis export rather than interactive viewing
- Generated PNG files are high-resolution (300 DPI) suitable for publication

## Future Enhancements

Planned improvements:
- Real-time trajectory visualization
- 3D trajectory path plotting
- Advanced statistical analysis (ANOVA, correlation analysis)
- Machine learning-based performance prediction
- Interactive web-based dashboard
