# ComparisonIK - Variance Analysis Implementation ✅ COMPLETED

This folder contains the **completed** ComparisonIK application with enhanced variance analysis capabilities for measuring execution time performance and variability of the `selectGoalPose` method.

## ✅ Implementation Status: COMPLETE

The variance analysis system has been **successfully implemented and tested** with the following features:

### ✅ Core Functionality Completed
- ✅ Multiple trial execution per pose (configurable, default 20 trials)
- ✅ Comprehensive trial data collection (timing, collision status, clearance metrics)
- ✅ Statistical variance analysis (mean, std dev, coefficient of variation, percentiles)
- ✅ CSV export with trial-level granularity
- ✅ Python visualization scripts with comprehensive plots
- ✅ Real-time progress tracking and detailed console output

### ✅ Verified Performance Results
Recent test run (5 poses × 20 trials = 100 total trials):
- **Success rate**: 100% across all poses
- **Mean execution time**: ~5.95ms with ~38% coefficient of variation
- **Execution time range**: 2.43ms to 13.61ms
- **Variance by pose**: 29.7% to 41.0% coefficient of variation
- **Total analysis time**: ~0.65 seconds for 100 trials

## Overview

The variance analysis implementation:
- Runs multiple trials (configurable, default 20) for each pose
- Collects detailed timing and performance metrics for each trial
- Calculates statistical measures including mean, standard deviation, coefficient of variation
- Exports data to CSV format for further analysis
- Provides Python visualization scripts for comprehensive data analysis

## Files

### C++ Implementation
- `comparison_ik.cpp` - Main application with variance analysis implementation
- `CMakeLists.txt` - Build configuration

### Python Visualization Scripts
- `plot_variance_analysis.py` - Comprehensive variance analysis visualization tool
- `plot_simple.py` - Simple execution time plotting script

### Generated Output Files
- `variance_analysis_results.csv` - Detailed trial-by-trial data
- `comparison_results.csv` - Summary comparison data
- Various `.png` plot files generated by Python scripts

## Building and Running

### Build the Application
```bash
cd /Users/joris/Uni/MA/Code/PathPlanner_US_wip
mkdir -p build && cd build
cmake ..
make ComparisonIK
```

### Run Variance Analysis
```bash
cd apps/ComparisonIK
./../../build/apps/ComparisonIK/ComparisonIK
```

The application will:
1. Process up to 5 poses (configurable)
2. Run 20 trials per pose (configurable in main function)
3. Export results to `variance_analysis_results.csv`
4. Display comprehensive statistics in the terminal

## Visualization

### Requirements
Install Python dependencies:
```bash
pip install pandas matplotlib seaborn numpy
```

### Comprehensive Analysis
```bash
python plot_variance_analysis.py --csv variance_analysis_results.csv --output-dir plots/
```

This creates:
- `execution_time_distribution.png` - Histograms, box plots, time series, violin plots
- `variance_metrics.png` - Variance analysis metrics and correlations
- `performance_summary.png` - Performance consistency and component analysis
- `variance_analysis_report.txt` - Detailed statistical report

### Simple Analysis
```bash
python plot_simple.py --csv variance_analysis_results.csv --output-dir plots/
```

This creates:
- `execution_time_analysis.png` - Basic execution time analysis plots

## Configuration

### Variance Analysis Parameters
Edit these variables in `main()` function of `comparison_ik.cpp`:

```cpp
int num_trials_per_pose = 20;  // Number of trials per pose
```

To process more poses, modify:
```cpp
if (poses.size() > 5) {
    poses.resize(5);  // Change 5 to desired number
}
```

### Input Files
Update these paths in `main()` function:
```cpp
std::string urdf_file = "/path/to/your/panda_US.urdf";
std::string scan_poses_file = "/path/to/your/scan_poses.csv";
std::string env_file = "/path/to/your/obstacles.xml";
```

## Data Structure

### VarianceAnalysisResult
Contains detailed metrics for multiple trials:
- `execution_times` - Vector of solve times for each trial
- `collision_check_times` - Vector of collision check times
- `clearance_compute_times` - Vector of clearance computation times
- `successes` - Boolean vector of success status per trial
- Statistical metrics: mean, std_dev, median, min, max, coefficient_of_variation
- `success_rate` - Fraction of successful trials

### CSV Output Format
The `variance_analysis_results.csv` contains one row per trial with columns:
- `pose_index` - Index of the pose being tested
- `method` - Always "selectGoalPose" 
- `trial_number` - Trial number (1 to num_trials_per_pose)
- `solve_time` - Execution time for this trial
- `collision_check_time` - Time spent on collision checking
- `clearance_compute_time` - Time spent computing clearance
- `success` - Whether the IK solution was found (0/1)
- `collision_free` - Whether the solution is collision-free (0/1)
- Error metrics: `position_error`, `orientation_error`
- Clearance metrics: `min_clearance`, `avg_clearance`, `weighted_clearance`
- `num_links_checked` - Number of robot links checked for collision
- Statistical summary: `mean_solve_time`, `std_dev_solve_time`, etc.

## Key Features

### Statistical Analysis
- **Mean and Standard Deviation**: Average performance and variability
- **Coefficient of Variation**: Normalized measure of relative variability
- **Median**: Robust central tendency measure
- **Min/Max**: Performance range bounds
- **Success Rate**: Reliability metric

### Visualizations
1. **Distribution Analysis**: Histograms and box plots show execution time distributions
2. **Variance Metrics**: Coefficient of variation, correlation analysis
3. **Performance Trends**: Time series showing performance across trials
4. **Comparative Analysis**: Success rates, component timing breakdowns

### Performance Insights
- Identify poses with high execution time variability
- Detect performance consistency issues
- Compare relative timing of different computation components
- Analyze correlation between timing and success rates

## Example Usage

```bash
# Build and run variance analysis
cd /Users/joris/Uni/MA/Code/PathPlanner_US_wip/build
make ComparisonIK
cd ../apps/ComparisonIK
./../../build/apps/ComparisonIK/ComparisonIK

# Generate comprehensive visualizations
python plot_variance_analysis.py --csv variance_analysis_results.csv --output-dir analysis_plots/

# Generate simple plots
python plot_simple.py --csv variance_analysis_results.csv --output-dir simple_plots/
```

## Expected Output

The variance analysis will produce detailed console output showing:
- Progress indicators for each pose and trial
- Statistical summaries for each pose
- Overall performance metrics
- File export confirmations

Example console output:
```
Processing pose 0/5 with 20 trials for variance analysis...
Trial 1/20: Success in 0.001234s
Trial 2/20: Success in 0.001456s
...
Variance Analysis Results for Pose 0:
  Mean execution time: 0.001345 seconds
  Standard deviation: 0.000123 seconds
  Coefficient of variation: 0.091456
  Success rate: 100.0%
```
